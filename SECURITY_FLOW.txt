â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ğŸ”’ SECURITY FLOW DIAGRAM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£ USER REGISTRATION FLOW (with bcryptjs):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User enters password: "password123"
           â†“
Frontend validates input
           â†“
Sends to Backend API
           â†“
bcryptjs.hash(password, 10)  â† ğŸ”’ SECURITY TOOL #1
           â†“
Hashed: "$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy"
           â†“
Stored in MySQL Database  â† ğŸ”’ SECURITY TOOL #5 (Parameterized Query)
           â†“
âœ… Password is SAFE (cannot be reversed)


2ï¸âƒ£ USER LOGIN FLOW (with JWT):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User enters: email + password
           â†“
Sends to Backend API
           â†“
Find user in database  â† ğŸ”’ Parameterized Query
           â†“
bcryptjs.compare(password, hashedPassword)  â† ğŸ”’ SECURITY TOOL #1
           â†“
Password matches? âœ…
           â†“
jwt.sign({ id: user.id }, SECRET_KEY)  â† ğŸ”’ SECURITY TOOL #2
           â†“
Generate Token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
           â†“
Send token to Frontend
           â†“
Store in localStorage
           â†“
âœ… User is AUTHENTICATED


3ï¸âƒ£ ACCESSING PROTECTED DATA (with JWT Middleware):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User clicks "View Complaints"
           â†“
Frontend sends request with token
Headers: { Authorization: "Bearer eyJhbGciOiJIUzI1..." }
           â†“
Backend receives request
           â†“
authenticateToken() middleware  â† ğŸ”’ SECURITY FEATURE
           â†“
jwt.verify(token, SECRET_KEY)  â† ğŸ”’ SECURITY TOOL #2
           â†“
Token valid? âœ…
           â†“
Extract user ID from token
           â†“
Query database for user's complaints  â† ğŸ”’ Parameterized Query
           â†“
Return ONLY user's data (not others')  â† ğŸ”’ Access Control
           â†“
âœ… Data is SECURE


4ï¸âƒ£ SQL INJECTION PREVENTION (with mysql2):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ INSECURE WAY (NOT USED):
query = "SELECT * FROM users WHERE email = '" + email + "'"
Hacker input: admin@test.com' OR '1'='1
Result: Returns ALL users! ğŸ’€

âœ… SECURE WAY (USED):
query = "SELECT * FROM users WHERE email = ?"
params = [email]
pool.query(query, params)  â† ğŸ”’ SECURITY TOOL #5
Hacker input: admin@test.com' OR '1'='1
Result: Treats entire string as email, returns nothing âœ…


5ï¸âƒ£ CORS PROTECTION (with cors):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Malicious Website (evil.com) tries to access API
           â†“
Browser sends request to http://localhost:5000
           â†“
CORS middleware checks origin  â† ğŸ”’ SECURITY TOOL #3
           â†“
Origin not allowed? âŒ
           â†“
Request BLOCKED
           â†“
âœ… API is PROTECTED


6ï¸âƒ£ ENVIRONMENT VARIABLES (with dotenv):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ INSECURE (NOT USED):
const password = "root123";  // Visible in code!
const secret = "my-secret-key";  // Uploaded to GitHub!

âœ… SECURE (USED):
.env file:  â† ğŸ”’ SECURITY TOOL #4
DB_PASSWORD=root123
JWT_SECRET_KEY=my-secret-key

Code:
const password = process.env.DB_PASSWORD;
const secret = process.env.JWT_SECRET_KEY;

.gitignore:
.env  â† Not uploaded to GitHub âœ…


7ï¸âƒ£ ROLE-BASED ACCESS CONTROL:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CITIZEN LOGIN:
User logs in â†’ Token: { id: 5, role: "citizen" }
           â†“
Accesses /api/complaints
           â†“
Query: SELECT * FROM complaints WHERE user_id = 5
           â†“
Returns: ONLY their complaints âœ…

ADMIN LOGIN:
Admin logs in â†’ Token: { id: 1, role: "admin" }
           â†“
Accesses /api/admin/complaints
           â†“
Query: SELECT * FROM complaints (all)
           â†“
Returns: ALL complaints from ALL users âœ…


8ï¸âƒ£ COMPLETE SECURITY FLOW:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User Registration
    â†“ [bcryptjs]
Password Hashed
    â†“ [mysql2 parameterized]
Stored Securely
    â†“
User Login
    â†“ [bcryptjs.compare]
Password Verified
    â†“ [jsonwebtoken]
JWT Token Generated
    â†“ [localStorage]
Token Stored
    â†“
User Makes Request
    â†“ [Authorization Header]
Token Sent
    â†“ [JWT Middleware]
Token Verified
    â†“ [Role Check]
Access Granted
    â†“ [Parameterized Query]
Data Retrieved
    â†“ [CORS]
Response Sent
    â†“
âœ… SECURE END-TO-END


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” SECURITY LAYERS:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Layer 1: CORS Protection (cors)
         â†“ Blocks unauthorized websites

Layer 2: JWT Authentication (jsonwebtoken)
         â†“ Verifies user identity

Layer 3: Role-Based Access (Database + JWT)
         â†“ Controls what users can see

Layer 4: SQL Injection Prevention (mysql2)
         â†“ Protects database

Layer 5: Password Hashing (bcryptjs)
         â†“ Protects passwords

Layer 6: Environment Variables (dotenv)
         â†“ Hides secrets

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… RESULT: MULTI-LAYERED SECURITY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Even if one layer is bypassed, other layers protect the system!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
